<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="description" content="" />
    <title>Check Out | Luxury Travel Site</title>
    <link rel="stylesheet" href="./css/style.css" type="text/css" />
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css" type="text/css" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400' rel='stylesheet' type='text/css'>
</head>
<body>
<!-- Google Tag Manager -->

    <script type="text/javascript" src="./js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="./js/purl.js"></script>
<script>

        var product = { // List of productFieldObjects.
                    'name': $.url().param('destination'),
                    'id': $.url().param('destination'),
                    'coupon': Math.floor((Math.random() * 1000) + 1) // Optional fields may be omitted or set to empty string.
                }
        var cat = 'Destinations/';
        if($.url().param('destination') === 'switzerland')
            cat += 'Europe';
        else 
            cat += 'NorthAmerica';
        
        product.category = cat;

    var dataLayer = [{
        'ecommerce': {
            'checkout': {
                'actionField': {'step': 1},
                'products': [product]
            }
        }
    }];
</script>

<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PQW9ZX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PQW9ZX');</script>

<!-- End Google Tag Manager -->
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="./">Luxury Travel Site</a>
                <ul class="nav">
                    <li><a href="./">Home</a></li>
                    <li><a href="./destinations.html">Destinations</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container" id="main">
        <div class="title">
            <h1>Luxury Travel Site</h1>
        </div>
        <p class="lead">The most luxurious way to travel the world.</p>
        
        <div class="container" id="content">
            <div class="page-header"><h1>Checkout <small>Can you feel the sun yet?</small></h1></div>
            <table class="table table-striped">
                <thead><tr>
                    <th>Description</th>
                    <th>Length</th>
                    <th>Price Per Person</th>
                    <th>Travellers</th>
                </tr></thead>
                <tbody>
                    <tr>
                        <td>A week-long stay in one of the most luxurious places ever.</td>
                        <td>6 nights</td>
                        <td>$799</td>
                        <td>
                            <select style="width:60px;" id="travellers">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div>
                <strong>Terms and Conditions</strong>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce risus nulla, convallis non aliquet at, scelerisque ut sem. Quisque felis mauris, auctor sit amet elementum at, gravida ut orci. Phasellus condimentum condimentum enim eu consequat. Suspendisse accumsan purus dolor.
            </div>
                
            <div style="text-align:right;">
                <h2>$<span id="price">799</span></h2>
                <h4>Total</h4>
            </div>
            <div class="text-center"><a href="./customer.html?price=799" class="btn btn-primary" id="submitButton"><h3>Submit Reservation</h3></a></div>
        </div> 
        <div class="text-center"><a href="./destinations.html" class="btn btn-primary remove-dest-link" id="removeButton"><h3>Remove from Cart</h3></a></div>
        </div>
        <footer class="footer">
            <p class="pull-right"><a href="#">Back to top</a></p>
            <p>This is a demo site designed to showcase GTM.</p>
        </footer>
    </div>
    
    <script type="text/javascript" src="./bootstrap/js/bootstrap.min.js"></script>
     <script language="JavaScript" type="text/javascript" src="./js/AppMeasurement.js"></script>
  
   <script type="text/javascript">
        $(document).ready(function() {
          var totalCost = 799 * $('#travellers').val(),
              destination = $.url().param('destination');
          $('#submitButton').attr('href','./customer.html?price=' + totalCost + '&destination=' + destination);
          $('#content td').first().text(destination);
          $('#travellers').on('change', function() {
              var totalCost = 799 * $('#travellers').val();
              $('#price').html(totalCost);
              $('#submitButton').attr('href','./customer.html?price=' + totalCost + '&destination=' + destination);
              $('#content td').first().text(destination);
              if (totalCost > 1000)
                  fireTags($(this).val());
          });
          function fireTags(value) {
              //ga('set', 'dimension2', value);
              //ga('send', 'event', 'Pocet osob', 'change', value);
              console.log('fire tags');
          }
        });
    </script>
    
    <script type="text/javascript">
     function getUrlParameters(parameter, staticURL, decode){
   /*
    Function: getUrlParameters
    Description: Get the value of URL parameters either from 
                 current URL or static URL
    Author: Tirumal
    URL: www.code-tricks.com
   */
   var currLocation = (staticURL.length)? staticURL : window.location.search,
       parArr = currLocation.split("?")[1].split("&"),
       returnBool = true;
   
   for(var i = 0; i < parArr.length; i++){
        parr = parArr[i].split("=");
        if(parr[0] == parameter){
            return (decode) ? decodeURIComponent(parr[1]) : parr[1];
            returnBool = true;
        }else{
            returnBool = false;            
        }
   }
   
   if(!returnBool) return false;  
};
        var click_measured = false;
        $(".remove-dest-link").click(function(event){
            if (click_measured === false) {
            event.preventDefault();
            // event.stopPropagation();
            
            // var rem = this;
            dataLayer.push({
                'event': 'removeFromCart',
                'ecommerce': {
                  'remove': {
                    'products': [{
                        'name': event.currentTarget.name.toLowerCase(),         // Name or ID is required.
                        'id': event.currentTarget.name.toLowerCase()
                     }]
                   }
                 }
            });
            console.log('data pushed to dataLayer');
            // dataLayer.push(function(){
            //     rem.click
            // });
            console.log('DRUNK PEOOPLEZ WANTZ FASTER GITHUB PAGEZZ!!!!1111oneoneone. To here, actually:', event.target.href);
            click_measured = true;
            /// $(".remove-dest-link").trigger('click');
            window.location.href = $(".remove-dest-link").attr("href");
            }
            
        });
        // $(this).trigger('click');
     </script>
    
   
</body>
</html>
